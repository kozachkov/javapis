---
lang: ru
layout: home
lang-ref: index
---

# Пометки (cookies)

Средство для хранения небольших данных служителя на стороне пользователя в
обозревателе.

Описаны в [RFC6265](https://datatracker.ietf.org/doc/html/rfc6265).

## Способы оставления пометок

- Посредством заголовка `Set-Cookie` из ответа от служителя (server).
- С помощью `document.cookie`.

## Ограничения для пометок

- Около 20 записей на область (domain), зависит от обозревателя.
- Размер не более 4Кб на запись.

## Взаимодейстие с пометками из Яваписи

Возможно с помощью `document.cookie`.

### Установка пометки

Обычный способ поле=значение: `document.cookie = 'var=value'`.

И расширенный с дополнительными ключами `document.cookie = 'var=value; path=/; secure'`.

Перед установкой имени и значения их следует преобразовать с помощью
`encodeURIComponent`.

### Чтение пометок

Так как `document.cookie` выдаст все пометки целиком, разделённые `;` в виде:

```
var1=val1;var2=val2;var3=val3
```

то считывать нужные следует самостоятельно.

И как правильно заметил данные о ключах нам таким образом недоступны, только имя
поля и его значение.

### Удаление пометок

Возможно с помощью установки ключа `max-age` в `-1`.

## Дополнительные ключи при установке пометки

## path -- ограничения на все страницы области или только на некоторые

`path=/;` или `path=/secret_pages/;`

## domain -- ограничения на передачу пометок подобласти

Если указать `domain=siteA.com`, то пометка будет доступна и для
`siteB.siteA.com`.

## expires, max-age -- время жизни пометки

`Tue, 29 Jan 2012 12:34:56 GMT` -- для `expires`, количество "секунд" для
`max-age`.

## secure -- ограничение на передачу пометок служителю только по https

`secure`.

## samesite -- защита от XSRF-нападений

`samesite=strict` -- не отправлять пометки, если запрос был с другой области.

`samesite=lax` -- позволяет отправлять пометки, только для http запросов чтения
-- например GET, подробнее в [RFC7231](https://datatracker.ietf.org/doc/html/rfc7231)
-- и только для случая изменения URL верхнего уровня.

Обозреватели до 2017-го года данный ключ не поддерживают, поэтому уязвимы для
таких нападений и в таком случае необходимо другое решение, например тайный
XSRF-ключ от служителя.

## httpOnly -- полное ограничение на доступ к пометкам посредством Яваписи

Если указать ключ httpOnly, то пометка не будет видна из `document.cookie`.

## Передача пометок обратно к служителю

С помощью заголовка Cookie.

## Сторонние пометки

Это пометки, которые устанавливает сторонний служитель, при обращение к нему со
страницы текущего: например, при загрузке изображения, расположенного на другой
площадке, он отдаст не только само изображение, но ещё и заголовок `Set-Cookie`.
Основная опасность -- отслеживание перемещение пользователя без его ведома.

## Ограничения законодательства

Если пометки используют для отслеживания или опознавания пользователей, то об
этом его следует уведомить в соответствии с законодательством соответствующих
стран.

- Галочка при создании учётки.
- Посредством участка на странице с явным подтверждением (нажимом) об
  ознакомлении.
